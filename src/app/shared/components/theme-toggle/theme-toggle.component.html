<div class="flex items-center gap-2 sm:gap-3 relative">
  <!-- Theme Mode Toggle -->
  <button
    type="button"
    (click)="toggleMode()"
    class="p-2.5 sm:p-3 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-accent shadow-sm hover:shadow-md hover:-translate-y-0.5 group"
    [title]="themeMode() === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode'"
    [attr.aria-label]="themeMode() === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode'"
  >
    @if (themeMode() === 'dark') {
      <ng-icon name="faSolidSun" class="text-yellow-500 text-lg sm:text-xl group-hover:rotate-45 transition-transform duration-300"></ng-icon>
    } @else {
      <ng-icon name="faSolidMoon" class="text-gray-700 dark:text-gray-300 text-lg sm:text-xl group-hover:-rotate-12 transition-transform duration-300"></ng-icon>
    }
  </button>

  <!-- Accent Color Picker Button -->
  <button
    type="button"
    (click)="toggleColorPicker()"
    class="p-2.5 sm:p-3 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-accent shadow-sm hover:shadow-md hover:-translate-y-0.5 group relative"
    title="Change Accent Color"
    aria-label="Change Accent Color"
    [attr.aria-expanded]="colorPickerOpen()"
  >
    <ng-icon name="faSolidPalette" class="text-gray-700 dark:text-gray-300 text-lg sm:text-xl group-hover:scale-110 transition-transform duration-300"></ng-icon>
    @if (colorPickerOpen()) {
      <span class="absolute -top-1 -right-1 w-3 h-3 bg-accent rounded-full animate-pulse"></span>
    }
  </button>

  <!-- Color Picker Dropdown -->
  @if (colorPickerOpen()) {
    <div class="absolute right-0 top-full mt-3 glass rounded-2xl shadow-modern-lg border border-gray-200/50 dark:border-gray-700/50 p-5 min-w-[280px] z-50 fade-in">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-sm sm:text-base font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2">
          <ng-icon name="faSolidSwatchbook" class="text-accent"></ng-icon>
          Accent Color
        </h3>
        <button
          type="button"
          (click)="toggleColorPicker()"
          class="p-1.5 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
          aria-label="Close color picker"
        >
          <ng-icon name="faSolidXmark" class="text-gray-500 dark:text-gray-400"></ng-icon>
        </button>
      </div>
      
      <div class="grid grid-cols-5 gap-3">
        @for (color of accentColors; track color) {
          <button
            type="button"
            (click)="selectAccentColor(color)"
            [class]="'relative w-12 h-12 rounded-xl transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 shadow-md hover:shadow-lg ' + getColorClasses(color)"
            [attr.aria-label]="'Select ' + getColorName(color) + ' accent color'"
            [title]="getColorName(color)"
          >
            @if (isSelected(color)) {
              <span class="absolute inset-0 flex items-center justify-center">
                <ng-icon name="faSolidCheck" class="text-white text-lg drop-shadow-lg"></ng-icon>
              </span>
              <span class="absolute -inset-1 border-2 border-gray-900 dark:border-gray-100 rounded-xl"></span>
            }
          </button>
        }
      </div>
      
      <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
        <p class="text-xs text-gray-600 dark:text-gray-400 text-center">
          Selected: <span class="font-semibold text-accent">{{ getColorName(accentColor()) }}</span>
        </p>
      </div>
    </div>
  }
</div>

