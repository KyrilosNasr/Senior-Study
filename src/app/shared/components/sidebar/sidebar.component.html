<!-- Mobile Sidebar -->
<p-drawer 
  [visible]="sidebarVisible()" 
  (visibleChange)="sidebarVisible.set($event)" 
  position="left"
  [header]="config.headerText" 
  [closeOnEscape]="true" 
  styleClass="w-72 lg:hidden"
  [ariaLabel]="'Mobile navigation menu for ' + config.title"
>
  <div class="p-4 overflow-y-auto max-h-[calc(100vh-4rem)] scrollbar-thin">
    <p-tree 
      [value]="treeNodes" 
      (onNodeSelect)="onNodeSelect($event)" 
      selectionMode="single"
      [style]="{ width: '100%', border: 'none' }" 
      styleClass="w-full border-none modern-tree"
      [ariaLabel]="'Navigation tree for ' + config.title + ' topics'"
    ></p-tree>
  </div>
</p-drawer>

<!-- Desktop Sidebar -->
<aside
  [class]="'hidden lg:flex flex-col fixed left-0 top-0 h-screen z-40 shadow-2xl border-r border-gray-200/50 dark:border-gray-700/50 transition-all duration-300 ' + sidebarGradient() + ' ' + sidebarWidthClass()"
  role="navigation"
  [attr.aria-label]="'Main navigation sidebar for ' + config.title"
  [attr.aria-expanded]="isExpanded()"
>
  <!-- Toggle Button -->
  <button
    type="button"
    (click)="toggleSidebar()"
    class="absolute -right-3 top-6 w-6 h-6 rounded-full bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-600 shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center z-50 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-accent-light focus:ring-offset-2 dark:focus:ring-accent-dark dark:focus:ring-offset-gray-900"
    [title]="isExpanded() ? 'Collapse sidebar' : 'Expand sidebar'"
    [attr.aria-label]="isExpanded() ? 'Collapse sidebar to show only icons' : 'Expand sidebar to show full navigation'"
    [attr.aria-expanded]="isExpanded()"
    aria-controls="sidebar-navigation"
  >
    <i [class]="'fas text-xs text-gray-600 dark:text-gray-300 transition-transform duration-300 ' + (isExpanded() ? 'fa-chevron-left' : 'fa-chevron-right')" aria-hidden="true"></i>
  </button>

  <!-- Sidebar Header -->
  <div class="p-4 flex-shrink-0 border-b border-gray-200/30 dark:border-gray-700/30 backdrop-blur-sm overflow-hidden" role="banner">
    @if (isExpanded()) {
      <div class="flex items-center gap-3 animate-fade-in">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-accent-light to-accent-dark flex items-center justify-center shadow-lg flex-shrink-0" aria-hidden="true">
          <i class="fas fa-book text-white text-lg"></i>
        </div>
        <div class="min-w-0 flex-1">
          <h1 [class]="'text-xl font-bold truncate ' + titleGradient()" id="sidebar-title">{{ config.title }}</h1>
          <p class="text-xs text-gray-600 dark:text-gray-400 font-medium truncate" id="sidebar-subtitle">{{ config.subtitle }}</p>
        </div>
      </div>
    } @else {
      <div class="flex justify-center animate-fade-in">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-accent-light to-accent-dark flex items-center justify-center shadow-lg" aria-hidden="true">
          <i class="fas fa-book text-white text-lg"></i>
        </div>
      </div>
    }
  </div>

  <!-- Navigation Tree -->
  <nav 
    id="sidebar-navigation" 
    class="flex-1 overflow-y-auto overflow-x-hidden py-4 scrollbar-thin min-h-0" 
    [class.px-2]="!isExpanded()" 
    [class.px-3]="isExpanded()"
    [attr.aria-label]="isExpanded() ? 'Full navigation menu' : 'Icon navigation menu'"
  >
    @if (isExpanded()) {
      <p-tree 
        [value]="treeNodes" 
        (onNodeSelect)="onNodeSelect($event)" 
        selectionMode="single"
        [style]="{ width: '100%', border: 'none' }" 
        styleClass="w-full border-none modern-tree"
        [ariaLabel]="'Navigation tree for ' + config.title + ' topics'"
      ></p-tree>
    } @else {
      <!-- Collapsed view - show clickable topic icons -->
      <div class="space-y-1" role="list" [attr.aria-label]="'Quick navigation icons for ' + config.title">
        @for (node of treeNodes; track node.label) {
          @if (node.children && node.children.length > 0) {
            <!-- Parent node with children -->
            <div class="space-y-1" role="group" [attr.aria-label]="node.label + ' topics'">
              @for (child of node.children; track child.label) {
                @if (child.data) {
                  <div class="relative group" role="listitem">
                    <button
                      type="button"
                      (click)="onCollapsedNodeClick(child)"
                      class="w-full p-2 rounded-lg hover:bg-white/10 dark:hover:bg-gray-700/50 transition-all duration-200 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-accent-light focus:ring-offset-2 focus:ring-offset-transparent dark:focus:ring-accent-dark"
                      [title]="child.label"
                      [attr.aria-label]="'Navigate to ' + child.label"
                      tabindex="0"
                    >
                      <i [class]="getIconClass(child)" class="text-gray-600 dark:text-gray-300 text-sm" aria-hidden="true"></i>
                    </button>
                    <!-- Tooltip on hover -->
                    <div 
                      class="absolute left-full ml-2 top-1/2 -translate-y-1/2 px-3 py-2 bg-gray-900 dark:bg-gray-700 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity duration-200 whitespace-nowrap z-50"
                      role="tooltip"
                      [attr.aria-hidden]="true"
                    >
                      {{ child.label }}
                    </div>
                  </div>
                }
              }
            </div>
          }
        }
      </div>
    }
  </nav>

  <!-- Sidebar Footer -->
  <div class="p-3 flex-shrink-0 border-t border-gray-200/30 dark:border-gray-700/30 backdrop-blur-sm overflow-hidden" role="contentinfo">
    @if (isExpanded()) {
      <div class="text-xs text-gray-500 dark:text-gray-400 text-center animate-fade-in">
        <p class="font-medium">Angular Study</p>
        <p class="mt-1 opacity-75">v1.0.0</p>
      </div>
    } @else {
      <div class="flex justify-center animate-fade-in" aria-label="Angular Study application">
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-accent-light to-accent-dark flex items-center justify-center text-white text-xs font-bold" aria-hidden="true">
          A
        </div>
      </div>
    }
  </div>
</aside>